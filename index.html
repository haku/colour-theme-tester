<html>
  <head>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0">
    <script>
      // https://en.wikipedia.org/wiki/ANSI_escape_code#3-bit_and_4-bit
      const themes = {
        "fae": [
          "#1e0010",  // witchhazel
          "#ab0a0a",  // fae
          "#009a4a",  // fae
          "#a79c00",  // fae
          "#1b7c8b",  // fae
          "#d84a7c",  // fae
          "#9253ff",  // fae
          "#DCC8FF",  // witchhazel
          "#3B364E",  // witchhazel
          "#DC7070",  // witchhazel
          "#81FFBE",  // witchhazel
          "#FFF9A3",  // witchhazel
          "#40ffff",  // https://github.com/tinted-theming/schemes/blob/spec-0.11/base16/moonlight.yaml
          "#FFB8D1",  // witchhazel
          "#C5A3FF",  // witchhazel
          "#BFBFBF",  // witchhazel
        ],
        "xterm16": [
          "rgb(0, 0, 0)",       "rgb(205, 0, 0)", "rgb(0, 205, 0)", "rgb(205, 205, 0)", "rgb(0, 0, 238)",   "rgb(205, 0, 205)", "rgb(0, 205, 205)", "rgb(229, 229, 229)",
          "rgb(127, 127, 127)", "rgb(255, 0, 0)", "rgb(0, 255, 0)", "rgb(255, 255, 0)", "rgb(92, 92, 255)", "rgb(255, 0, 255)", "rgb(0, 255, 255)", "rgb(255, 255, 255)",
        ],
        "ubuntu": [
          "rgb(1, 1, 1)",       "rgb(222, 56, 43)", "rgb(57, 181, 74)", "rgb(255, 199, 6)", "rgb(0, 111, 184)", "rgb(118, 38, 113)", "rgb(44, 181, 233)", "rgb(204, 204, 204)",
          "rgb(128, 128, 128)", "rgb(255, 0, 0)",   "rgb(0, 255, 0)",   "rgb(255, 255, 0)", "rgb(0, 0, 255)",   "rgb(255, 0, 255)",  "rgb(0, 255, 255)",  "rgb(255, 255, 255)",
        ],
        "vscode": [
          "rgb(0, 0, 0)",      "rgb(205, 49, 49)", "rgb(13, 188, 121)", "rgb(229, 229, 16)", "rgb(36, 114, 200)", "rgb(188, 63, 188)",  "rgb(17, 168, 205)", "rgb(229, 229, 229)",
          "rgb(102, 102, 102)","rgb(241, 76, 76)", "rgb(35, 209, 139)", "rgb(245, 245, 67)", "rgb(59, 142, 234)", "rgb(214, 112, 214)", "rgb(41, 184, 219)", "rgb(229, 229, 229)",
        ],
      };
      let currentTheme;

      // https://stackoverflow.com/questions/1740700/how-to-get-hex-color-value-rather-than-rgb-value
      const rgbToHex = (rgb) => `#${rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/).slice(1).map(n => parseInt(n, 10).toString(16).padStart(2, '0')).join('')}`

      function parseColour(text) {
        if (text.match(/^#?[0-f]{3}$|^#?[0-f]{6}$/)) {
          if (!text.startsWith('#')) text = '#' + text;
          return text;
        }
        return null;
      }

      // https://stackoverflow.com/questions/596216/
      function colourLuma(hex) {
        const m = [0.2126, 0.7152, 0.0722];  // ITU BT.709
        hex = hex.replace(/^#/, '');
        if (hex.length == 3) hex = hex.split("").map(c => c + c).join("");
        let ret = 0;
        for (let i = 0; i < 3; i++) {
          ret += m[i] * parseInt(hex.substr(i * 2, 2), 16);
        }
        return Math.ceil(ret);
      }

      function lumaToColour(luma) {
        const hex = luma.toString(16).padStart(2, "0");
        return '#' + hex + hex + hex;
      }

      function loadButtons() {
        const holder = document.querySelector('.buttons');
        for (const theme in themes) {
          const btn = document.createElement('button');
          btn.textContent = theme;
          btn.onclick = () => applyTheme(theme);
          holder.append(btn);
        }

        const useedits = document.querySelector('#useedits');
        useedits.onchange = (e) => applyTheme();

        if (window.location.hash) {
          const editinputs = document.querySelectorAll('.editpallet .editinput');
          window.location.hash.replace(/^#/, '').split(',').forEach((item) => {
            const parts = item.split('=');
            if (parts.length != 2) return;
            if (!parts[0].match(/^c[0-f]$/)) return;
            const i = parseInt(parts[0].substr(1, 1), 16);
            const col = parseColour(parts[1]);
            if (!col) return;
            editinputs[i].value = col;
          });
        }

        const editswatchs = document.querySelectorAll('.editpallet .swatch');
        editswatchs.forEach((swatch) => {
          const input = swatch.querySelector('.editinput');
          input.oninput = (e) => {
            const col = parseColour(input.value);
            if (col) {
              swatch.style.setProperty('background-color', col);
              input.classList.remove('invalid');
            }
            else if (input.value.length < 1) {
              input.classList.remove('invalid');
            }
            else {
              input.classList.add('invalid');
            }
            applyTheme();
          };
          input.oninput();  // for browser remembering values.
        });
      }

      function applyTheme(theme) {
        if (theme) currentTheme = theme;
        if (!currentTheme) return;
        theme = currentTheme;

        const colours = themes[theme];
        const swatches = document.querySelectorAll('.pallet .swatch');

        const useedits = document.querySelector('#useedits').checked;
        const editinputs = document.querySelectorAll('.editpallet .editinput');
        let fragment = "";

        const lumas = document.querySelectorAll('.pallet .luma');

        for (let i = 0; i < 16; i++) {
          let hex;
          const editHex = parseColour(editinputs[i].value);
          if (editHex) fragment += "c" + i.toString(16) + "=" + editHex.replace('#', '') + ",";
          if (useedits) hex = editHex;

          const swatch = swatches[i];
          swatch.style.setProperty('background-color', colours[i]);
          const themehex = rgbToHex(window.getComputedStyle(swatch).backgroundColor);
          swatch.setHTMLUnsafe(i.toString(16) + '<br>' + themehex);

          if (!hex) hex = themehex;
          document.documentElement.style.setProperty('--c' + i.toString(16), hex);

          const luma = colourLuma(hex);
          lumas[i].innerText = luma;
          document.documentElement.style.setProperty('--l' + i.toString(16), lumaToColour(luma));
        }

        if (fragment) window.location.hash = fragment;
      }

      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.shiftKey) return;
        if (!e.altKey) {
          switch (e.target.tagName.toLowerCase()) {
            case 'input':
            case 'textarea':
              return;
          }
        }
        switch (e.key) {
          case 'e':
            event.preventDefault();
            document.querySelector('#useedits').click();
            break;
        }
      });

      window.onload = () => {
        loadButtons();
        applyTheme('fae');
      };
    </script>
    <style>
      :root, input {
        background: #000;
        color: #fff;
        font-family: monospace;
      }
      .buttons button,
      input[type="checkbox"], label {
        padding: 0.25em 1em;
        margin: 0 0.5em;
        height: 3em;
        vertical-align: middle;
      }
      .pallet,
      .editpallet {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        width: 72em;
        padding: 1em;
      }
      .swatch {
        margin: 0em;
        text-align: center;
        padding: 1em;
        text-shadow: 1px 1px black;
      }
      .luma {
        text-align: center;
        padding: 0.2em;
        text-shadow: 1px 1px black;
      }
      .editinput {
        width: 11ex;
        border: 1px solid #aaa;
      }
      .editinput.invalid {
        border: 1px solid #f00;
      }
      .columns {
        display: flex;
        flex-wrap: wrap;
        gap: 1em;
        padding: 1em;
      }
      .columns>div {
        flex: 0 0 10em;
        flex-grow: 1;
        text-align: center;
      }
      .columns>div>p {
        padding: 0.25em;
      }
    </style>
  </head>
  <body>
    <div class="buttons" style="padding: 0.5em;">
      <input type="checkbox" id="useedits" checked></input><label for="useedits">edits</label>
    </div>

    <div class="pallet">
      <div class="swatch" style="background-color: var(--c0);">0</div>
      <div class="swatch" style="background-color: var(--c1);">1</div>
      <div class="swatch" style="background-color: var(--c2);">2</div>
      <div class="swatch" style="background-color: var(--c3);">3</div>
      <div class="swatch" style="background-color: var(--c4);">4</div>
      <div class="swatch" style="background-color: var(--c5);">5</div>
      <div class="swatch" style="background-color: var(--c6);">6</div>
      <div class="swatch" style="background-color: var(--c7);">7</div>
      <div class="swatch" style="background-color: var(--c8);">8</div>
      <div class="swatch" style="background-color: var(--c9);">9</div>
      <div class="swatch" style="background-color: var(--ca);">a</div>
      <div class="swatch" style="background-color: var(--cb);">b</div>
      <div class="swatch" style="background-color: var(--cc);">c</div>
      <div class="swatch" style="background-color: var(--cd);">d</div>
      <div class="swatch" style="background-color: var(--ce);">e</div>
      <div class="swatch" style="background-color: var(--cf);">f</div>
    </div>

    <div class="editpallet">
      <div class="swatch" style="background-color: #000">0<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">1<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">2<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">3<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">4<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">5<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">6<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">7<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">8<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">9<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">a<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">b<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">c<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">d<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">e<br><input type="text" class="editinput"></input></div>
      <div class="swatch" style="background-color: #000">f<br><input type="text" class="editinput"></input></div>
    </div>

    <div class="pallet">
      <div class="luma" style="background-color: var(--l0);"></div>
      <div class="luma" style="background-color: var(--l1);"></div>
      <div class="luma" style="background-color: var(--l2);"></div>
      <div class="luma" style="background-color: var(--l3);"></div>
      <div class="luma" style="background-color: var(--l4);"></div>
      <div class="luma" style="background-color: var(--l5);"></div>
      <div class="luma" style="background-color: var(--l6);"></div>
      <div class="luma" style="background-color: var(--l7);"></div>
      <div class="luma" style="background-color: var(--l8);"></div>
      <div class="luma" style="background-color: var(--l9);"></div>
      <div class="luma" style="background-color: var(--la);"></div>
      <div class="luma" style="background-color: var(--lb);"></div>
      <div class="luma" style="background-color: var(--lc);"></div>
      <div class="luma" style="background-color: var(--ld);"></div>
      <div class="luma" style="background-color: var(--le);"></div>
      <div class="luma" style="background-color: var(--lf);"></div>
    </div>

    <div class="columns">
      <div style="background-color: #000;">
        <p style="color: #fff;">(#000)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
        <p style="color: #fff; background-color: var(--c1);">background 1</p>
        <p style="color: #fff; background-color: var(--c2);">background 2</p>
        <p style="color: #fff; background-color: var(--c3);">background 3</p>
        <p style="color: #fff; background-color: var(--c4);">background 4</p>
        <p style="color: #fff; background-color: var(--c5);">background 5</p>
        <p style="color: #fff; background-color: var(--c6);">background 6</p>
        <p style="color: #fff; background-color: var(--c7);">background 7</p>
        <p style="color: var(--c1);">background 1</p>
        <p style="color: var(--c2);">background 2</p>
        <p style="color: var(--c3);">background 3</p>
        <p style="color: var(--c4);">background 4</p>
        <p style="color: var(--c5);">background 5</p>
        <p style="color: var(--c6);">background 6</p>
        <p style="color: var(--c7);">background 7</p>
      </div>
      <div style="background-color: var(--c0);">
        <p style="color: #fff;">(background 0)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
        <p style="color: var(--c0); background-color: var(--c7);">foreground 7</p>
        <p style="color: var(--c0); background-color: var(--c8);">foreground 8</p>
        <p style="color: var(--c0); background-color: var(--c9);">foreground 9</p>
        <p style="color: var(--c0); background-color: var(--ca);">foreground a</p>
        <p style="color: var(--c0); background-color: var(--cb);">foreground b</p>
        <p style="color: var(--c0); background-color: var(--cc);">foreground c</p>
        <p style="color: var(--c0); background-color: var(--cd);">foreground d</p>
        <p style="color: var(--c0); background-color: var(--ce);">foreground e</p>
        <p style="color: var(--c0); background-color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c1);">
        <p style="color: #fff;">(background 1)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c2);">
        <p style="color: #fff;">(background 2)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c3);">
        <p style="color: #fff;">(background 3)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c4);">
        <p style="color: #fff;">(background 4)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c5);">
        <p style="color: #fff;">(background 5)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c6);">
        <p style="color: #fff;">(background 6)</p>
        <p style="color: var(--c7);">foreground 7</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
      <div style="background-color: var(--c7);">
        <p style="color: #fff;">(background 7)</p>
        <p style="">&nbsp;</p>
        <p style="color: var(--c8);">foreground 8</p>
        <p style="color: var(--c9);">foreground 9</p>
        <p style="color: var(--ca);">foreground a</p>
        <p style="color: var(--cb);">foreground b</p>
        <p style="color: var(--cc);">foreground c</p>
        <p style="color: var(--cd);">foreground d</p>
        <p style="color: var(--ce);">foreground e</p>
        <p style="color: var(--cf);">foreground f</p>
      </div>
    </div>
  </body>
</html>
